<!DOCTYPE html>
<html lang="vi">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Thanh to√°n - Bill Gates Store</title>
      <link rel="stylesheet" href="style-checkout.css" />
  </head>
  <body>
      <div class="header">
          <h1>üõçÔ∏è Thanh to√°n </h1>
          <p>Ki·ªÉm tra l·∫°i gi·ªè h√†ng v√† ho√†n t·∫•t th√¥ng tin ƒë·∫∑t h√†ng</p>
      </div>
      <div class="main-container">
          <div class="left-panel">
              <div class="glass-card">
                  <a href="menu.html" class="back-to-menu-link">‚¨ÖÔ∏è Quay l·∫°i Menu</a>
                  <div class="card-title">
                      <div class="card-icon">üõí</div>
                      Gi·ªè h√†ng c·ªßa b·∫°n
                  </div>
                  <div class="cart-section" id="cart-items">
                      <div class="cart-empty">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</div>
                  </div>
                  <div class="summary-box">
                      <div class="summary-row">
                          <span>T·∫°m t√≠nh:</span>
                          <span id="subtotal">0ƒë</span>
                      </div>
                      <div class="summary-row">
                          <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
                          <span id="shipping">15.000ƒë</span>
                      </div>
                      <div class="summary-row summary-total">
                          <span>T·ªïng c·ªông:</span>
                          <span id="total">15.000ƒë</span>
                      </div>
                  </div>
              </div>
          </div>
          <div class="form-container">
              <div class="form-title">üí≥ Th√¥ng tin ƒë·∫∑t h√†ng</div>
              <form id="order-form">
                  <div class="form-group" style="margin-bottom: 1rem;">
                      <label class="form-label">üë§ H·ªç v√† t√™n</label>
                      <input type="text" class="form-input" name="fullname" placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß" required>
                  </div>
                  <div class="form-group" style="margin-bottom: 1rem;">
                      <label class="form-label">üì± S·ªë ƒëi·ªán tho·∫°i</label>
                      <input type="tel" class="form-input" name="phone" placeholder="0xxx xxx xxx" required>
                  </div>
                  <div class="form-group">
                      <label class="form-label">üí∞ Ph∆∞∆°ng th·ª©c thanh to√°n</label>
                      <div class="payment-options">
                          <div class="payment-option">
                              <input type="radio" id="cod" name="payment" value="cod" checked>
                              <label for="cod" class="payment-label">üíµ Thanh to√°n khi nh·∫≠n h√†ng (COD)</label>
                          </div>
                          <div class="payment-option">
                              <input type="radio" id="card" name="payment" value="card">
                              <label for="card" class="payment-label">üí≥ Th·∫ª t√≠n d·ª•ng/ghi n·ª£</label>
                          </div>
                      </div>
                  </div>
                  <button type="submit" class="submit-btn">üöÄ X√°c nh·∫≠n ƒë·∫∑t h√†ng</button>
              </form>
          </div>
      </div>

      <script>
        /**
         * D·ªäCH V·ª§ QU·∫¢N L√ù GI·ªé H√ÄNG (D√ôNG CHUNG)
         */
        const CartService = {
          getCart: () => {
            const cartData = sessionStorage.getItem('shoppingCart');
            return cartData ? JSON.parse(cartData) : {};
          },
          clearCart: () => {
            sessionStorage.removeItem('shoppingCart');
          },
          getTotalPrice: () => {
            const cart = CartService.getCart();
            return Object.values(cart).reduce((sum, item) => sum + (item.price * item.quantity), 0);
          },
          getTotalItems: () => {
            const cart = CartService.getCart();
            return Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
          }
        };

        /**
         * SCRIPT RI√äNG CHO TRANG CHECKOUT.HTML
         */
        document.addEventListener("DOMContentLoaded", () => {
          // --- C√°c h√†m ti·ªán √≠ch ---
          const utils = {
            formatPrice: (price) => new Intl.NumberFormat("vi-VN").format(price) + "ƒë",
          };

          // --- UI Functions ---
          const ui = {
            renderCartItems: (cart) => {
              const cartContainer = document.getElementById('cart-items');
              if (Object.keys(cart).length === 0) {
                cartContainer.innerHTML = '<div class="cart-empty">Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</div>';
                return;
              }
              cartContainer.innerHTML = Object.values(cart).map(item => `
                <div class="product-item">
                  <div class="product-info">
                    <h4>${item.name}</h4>
                    <span>S·ªë l∆∞·ª£ng: ${item.quantity}</span>
                  </div>
                  <div class="product-price">
                    ${utils.formatPrice(item.price * item.quantity)}
                  </div>
                </div>
              `).join('');
            },
            updateSummary: (cart) => {
              const subtotal = CartService.getTotalPrice();
              const shippingFee = subtotal > 0 ? 15000 : 0;
              const total = subtotal + shippingFee;

              document.getElementById('subtotal').textContent = utils.formatPrice(subtotal);
              document.getElementById('shipping').textContent = utils.formatPrice(shippingFee);
              document.getElementById('total').textContent = utils.formatPrice(total);
            }
          };

          // --- Kh·ªüi t·∫°o v√† G√°n s·ª± ki·ªán ---
          const initializePage = () => {
            const cart = CartService.getCart();
            ui.renderCartItems(cart);
            ui.updateSummary(cart);
          };

          document.getElementById('order-form').addEventListener('submit', (event) => {
            event.preventDefault();
            if (CartService.getTotalItems() === 0) {
              alert("Gi·ªè h√†ng c·ªßa b·∫°n ƒëang tr·ªëng!");
              return;
            }
            alert("ƒê·∫∑t h√†ng th√†nh c√¥ng! C·∫£m ∆°n b·∫°n ƒë√£ mua h√†ng.");
            CartService.clearCart();
            window.location.href = 'order-type.html'; // Quay v·ªÅ trang b·∫Øt ƒë·∫ßu
          });

          initializePage();
        });
      </script>
  </body>
</html>