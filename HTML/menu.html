<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Menu Nh√† H√†ng</title>
    <link rel="stylesheet" href="style-menu.css" />
  </head>
  <body>
    <div class="container">
        <aside class="sidebar" id="sidebar">
            <a href="index.html" class="logo">üçΩÔ∏è Danh m·ª•c</a>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" onclick="app.filterCategory(event, 'all')">üè† Menu ch√≠nh</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="app.filterCategory(event, 'food')">‚òï ƒêi·ªÉm t√¢m</a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" onclick="app.filterCategory(event, 'drink')">‚òï ƒê·ªì u·ªëng </a>
                </li>
            </ul>
        </aside>
        <main class="main-content">
            <div class="cart-summary">
                <div class="cart-info">
                    <span>üõí Gi·ªè h√†ng</span>
                    <span class="cart-count" id="cartCount">0</span>
                </div>
                <div class="cart-total" id="cartTotal">0ƒë</div>
                <button class="checkout-btn" onclick="app.goToCheckout()">ƒê·∫∑t h√†ng</button>
            </div>
            <div class="header">
                <h1 class="page-title">Menu ch√≠nh</h1>
            </div>
            <div class="menu-grid" id="menuGrid"></div>
        </main>
    </div>

    <script>
      /**
       * D·ªäCH V·ª§ QU·∫¢N L√ù GI·ªé H√ÄNG (D√ôNG CHUNG)
       */
      const CartService = {
        getCart: () => {
          const cartData = sessionStorage.getItem('shoppingCart');
          return cartData ? JSON.parse(cartData) : {};
        },
        saveCart: (cart) => {
          sessionStorage.setItem('shoppingCart', JSON.stringify(cart));
        },
        addItem: (item, quantity) => {
          const cart = CartService.getCart();
          const currentQuantity = cart[item.id] ? cart[item.id].quantity : 0;
          cart[item.id] = { ...item, quantity: currentQuantity + quantity };
          CartService.saveCart(cart);
        },
        getTotalItems: () => {
          const cart = CartService.getCart();
          return Object.values(cart).reduce((sum, item) => sum + item.quantity, 0);
        },
        getTotalPrice: () => {
          const cart = CartService.getCart();
          return Object.values(cart).reduce((sum, item) => sum + (item.price * item.quantity), 0);
        },
      };

      /**
       * SCRIPT RI√äNG CHO TRANG MENU.HTML
       */
      document.addEventListener("DOMContentLoaded", () => {
        // --- D·ªØ li·ªáu v√† C·∫•u h√¨nh ---
        const menuData = [
          { id: 101, name: "B√°nh Burger", description: "B√°nh burger b√≤ th∆°m ngon.", price: 89000, category: "food", image: "üçî" },
          { id: 102, name: "G√† R√°n", description: "G√† r√°n gi√≤n r·ª•m, v·ªã cay nh·∫π.", price: 95000, category: "food", image: "üçó" },
          { id: 103, name: "N∆∞·ªõc ng·ªçt", description: "N∆∞·ªõc ng·ªçt, n∆∞·ªõc su·ªëi, n∆∞·ªõc tr√°i c√¢y.", price: 25000, category: "drink", image: "ü•§" },
          { id: 104, name: "Tr√°ng Mi·ªáng", description: "B√°nh ng·ªçt, kem t∆∞∆°i.", price: 45000, category: "food", image: "üç∞" },
          { id: 105, name: "M√≥n ƒÇn Nh·∫π", description: "Khoai t√¢y chi√™n, salad.", price: 35000, category: "food", image: "üçü" },
          { id: 106, name: "Cafe S·ªØa", description: "Cafe pha phin ƒë·∫≠m ƒë√†.", price: 29000, category: "drink", image: "‚òï" },
          { id: 107, name: "Tr√† ƒê√†o", description: "Tr√† ƒë√†o th∆°m m√°t, mi·∫øng ƒë√†o gi√≤n.", price: 35000, category: "drink", image: "üçë" },
        ];
        
        // State l∆∞u s·ªë l∆∞·ª£ng t·∫°m th·ªùi tr√™n trang
        const state = { quantities: {} };
        menuData.forEach(item => { state.quantities[item.id] = 0; });

        // --- DOM Elements ---
        const elements = {
          menuGrid: document.getElementById("menuGrid"),
          cartCount: document.getElementById("cartCount"),
          cartTotal: document.getElementById("cartTotal"),
          pageTitle: document.querySelector(".page-title"),
          navLinks: document.querySelectorAll(".nav-link"),
        };

        // --- C√°c h√†m ti·ªán √≠ch ---
        const utils = {
          formatPrice: (price) => new Intl.NumberFormat("vi-VN").format(price) + "ƒë",
          showNotification: (message) => {
            const notification = document.createElement("div");
            notification.className = "notification";
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 2000);
          },
        };

        // --- UI Functions ---
        const ui = {
          updateCartDisplay: () => {
            elements.cartCount.textContent = CartService.getTotalItems();
            elements.cartTotal.textContent = utils.formatPrice(CartService.getTotalPrice());
          },
          createMenuItem: (item) => `
            <div class="menu-item" data-category="${item.category}">
              <div class="item-name">${item.image} ${item.name}</div>
              <div class="item-price">${utils.formatPrice(item.price)}</div>
              <div class="item-description">${item.description}</div>
              <div class="item-controls">
                <div class="quantity-control">
                  <button class="qty-btn" onclick="app.updateQuantity(${item.id}, -1)">‚àí</button>
                  <span class="qty-display" data-qty-id="${item.id}">0</span>
                  <button class="qty-btn" onclick="app.updateQuantity(${item.id}, 1)">+</button>
                </div>
                <button class="add-to-cart" onclick="app.addToCart(${item.id})">
                  Th√™m v√†o gi·ªè
                </button>
              </div>
            </div>`,
          renderMenu: (category = "all") => {
            const filteredItems = category === "all" ? menuData : menuData.filter(item => item.category === category);
            elements.menuGrid.innerHTML = filteredItems.map(ui.createMenuItem).join("");
          },
          updateQuantityDisplay: (itemId, newQty) => {
            const qtyDisplay = document.querySelector(`[data-qty-id="${itemId}"]`);
            if (qtyDisplay) qtyDisplay.textContent = newQty;
          }
        };

        // --- App Logic ---
        const app = {
          updateQuantity: (itemId, change) => {
            const currentQty = state.quantities[itemId] || 0;
            const newQty = Math.max(0, currentQty + change);
            state.quantities[itemId] = newQty;
            ui.updateQuantityDisplay(itemId, newQty);
          },
          addToCart: (itemId) => {
            const quantity = state.quantities[itemId];
            if (quantity === 0) {
              utils.showNotification("Vui l√≤ng ch·ªçn s·ªë l∆∞·ª£ng!");
              return;
            }
            const item = menuData.find(p => p.id === itemId);
            CartService.addItem(item, quantity);
            utils.showNotification(`ƒê√£ th√™m ${quantity} ${item.name} v√†o gi·ªè h√†ng!`);
            ui.updateCartDisplay();
            app.updateQuantity(itemId, -quantity); // Reset s·ªë l∆∞·ª£ng v·ªÅ 0
          },
          filterCategory: (event, category) => {
            event.preventDefault();
            ui.renderMenu(category);
            elements.navLinks.forEach(link => link.classList.remove("active"));
            event.currentTarget.classList.add("active");
            const titles = { all: "Menu ch√≠nh", food: "ƒêi·ªÉm t√¢m", drink: "McCafe" };
            elements.pageTitle.textContent = titles[category];
          },
          goToCheckout: () => {
            if (CartService.getTotalItems() === 0) {
              utils.showNotification("Gi·ªè h√†ng tr·ªëng, vui l√≤ng ch·ªçn m√≥n!");
              return;
            }
            window.location.href = 'checkout.html';
          }
        };

        // ƒê∆∞a c√°c h√†m c·∫ßn thi·∫øt ra global scope ƒë·ªÉ HTML c√≥ th·ªÉ g·ªçi
        window.app = app;

        // --- Kh·ªüi t·∫°o ---
        ui.renderMenu();
        ui.updateCartDisplay();
      });
    </script>
  </body>
</html>